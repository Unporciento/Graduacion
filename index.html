<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Navigator AI - Asistente de Estudio Inteligente</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Base y Tipografía */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #a7bfe8 0%, #619afb 100%); /* Tonos más suaves y profesionales */
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        /* Contenedor Principal */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 40px);
        }

        /* Encabezado */
        .header {
            background: linear-gradient(45deg, #1f4068 0%, #162447 100%); /* Colores más oscuros y serios */
            color: white;
            padding: 35px;
            text-align: center;
            border-bottom: 5px solid #0a1128;
        }

        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 12px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.95;
            max-width: 700px;
            margin: 0 auto;
        }

        /* Navegación por Pestañas */
        .nav-tabs {
            display: flex;
            background: #e9f0f8; /* Fondo más claro para las pestañas */
            border-bottom: 1px solid #d0dbe9;
        }

        .nav-tab {
            flex: 1;
            padding: 22px;
            text-align: center;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.15rem;
            font-weight: 600;
            color: #5a6b82;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 4px;
            background: #1f4068; /* Color de la línea activa */
            transition: width 0.3s ease;
        }

        .nav-tab.active {
            background: white;
            color: #1f4068;
            font-weight: 700;
        }

        .nav-tab.active::after {
            width: 100%;
        }

        .nav-tab:hover:not(.active) {
            background: #dce4ed;
            color: #1f4068;
        }

        /* Contenido de Pestañas */
        .tab-content {
            display: none;
            padding: 40px;
            flex-grow: 1; /* Para que ocupe el espacio restante */
            animation: fadeIn 0.6s ease-out;
        }

        .tab-content.active {
            display: block;
            display: flex; /* Permite un layout interno flexible */
            flex-direction: column;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Zonas de Carga (Upload) */
        .upload-zone {
            border: 3px dashed #c0ccda; /* Borde más sutil */
            border-radius: 18px;
            padding: 60px;
            text-align: center;
            margin-bottom: 35px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: #fdfefe; /* Fondo casi blanco */
        }

        .upload-zone:hover {
            border-color: #1f4068;
            background: #f5f8fc;
        }

        .upload-zone.dragover {
            border-color: #1f4068;
            background: #eef2ff;
        }

        .upload-icon {
            font-size: 3.5rem;
            color: #8c9cb3;
            margin-bottom: 25px;
        }

        .upload-zone h3 {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-zone p {
            font-size: 1.1rem;
            color: #666;
        }

        /* Botones */
        .btn {
            background: linear-gradient(45deg, #1f4068 0%, #162447 100%);
            color: white;
            padding: 14px 35px;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 8px 5px; /* Más espacio entre botones */
            box-shadow: 0 4px 15px rgba(31, 64, 104, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(31, 64, 104, 0.35);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #6c7a89 0%, #4a5a6a 100%);
            box-shadow: 0 4px 15px rgba(108, 122, 137, 0.2);
        }
        .btn-secondary:hover {
            box-shadow: 0 8px 25px rgba(108, 122, 137, 0.35);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.2);
        }
        .btn-danger:hover {
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.35);
        }

        /* Textarea */
        .textarea {
            width: 100%;
            min-height: 350px; /* Un poco más grande */
            padding: 25px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.05rem;
            font-family: 'Inter', sans-serif;
            resize: vertical;
            margin-bottom: 25px;
            line-height: 1.6;
            color: #333;
            background-color: #fdfefe;
        }

        .textarea:focus {
            outline: none;
            border-color: #1f4068;
            box-shadow: 0 0 0 4px rgba(31, 64, 104, 0.15);
        }

        /* Elementos de Materiales */
        .material-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 18px;
            padding: 25px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .material-item:hover {
            border-color: #1f4068;
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
        }

        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            flex-wrap: wrap; /* Para responsividad */
            gap: 10px;
        }

        .material-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a2a3a;
        }

        .material-type {
            background: #1f4068;
            color: white;
            padding: 8px 18px;
            border-radius: 25px;
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .material-content {
            color: #555;
            line-height: 1.7;
            margin-bottom: 18px;
        }

        .material-content p {
            margin-bottom: 8px;
        }

        /* Sección de Análisis */
        .analysis-section {
            background: #f8fbfc;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #eef2f6;
        }

        .analysis-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1a2a3a;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .error-item {
            background: #fff0f0;
            border: 1px solid #fccdcd;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
            color: #c0392b;
        }

        .error-type {
            font-weight: 700;
            color: #e74c3c;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .suggestion-item {
            background: #eefbff;
            border: 1px solid #bceeff;
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
            color: #0c729c;
        }

        .suggestion-type {
            font-weight: 700;
            color: #0369a1;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        /* Grid de Estadísticas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 35px;
        }

        .stat-card {
            background: white;
            border-radius: 18px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #eff3f7;
        }

        .stat-card:hover {
            transform: translateY(-7px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            color: #1f4068;
            margin-bottom: 12px;
        }

        .stat-label {
            color: #666;
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* Elementos Auxiliares */
        .hidden {
            display: none;
        }

        .progress-bar {
            background: #e6eef5;
            border-radius: 12px;
            height: 22px;
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .progress-fill {
            background: linear-gradient(90deg, #1f4068, #162447);
            height: 100%;
            transition: width 0.4s ease;
            border-radius: 12px;
        }

        .ai-score {
            display: inline-block;
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .ai-score.high {
            background: #d4edda;
            color: #28a745;
        }

        .ai-score.medium {
            background: #fff3cd;
            color: #ffc107;
        }

        .ai-score.low {
            background: #f8d7da;
            color: #dc3545;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #777;
            font-size: 1.2rem;
        }

        .spinner {
            border: 5px solid #f3f4f6;
            border-top: 5px solid #1f4068;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: #888;
            background: #fcfdfe;
            border-radius: 15px;
            margin-top: 30px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.03);
        }

        .empty-icon {
            font-size: 4.5rem;
            margin-bottom: 25px;
            opacity: 0.4;
        }

        .empty-state h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: #555;
        }

        .empty-state p {
            font-size: 1.1rem;
        }

        /* Estilos para el select de materias */
        .select-wrapper {
            position: relative;
            flex: 1;
        }

        #subjectSelect {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1.05rem;
            font-family: 'Inter', sans-serif;
            background-color: white;
            appearance: none; /* Eliminar estilo nativo del select */
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
            color: #333;
            transition: all 0.3s ease;
        }

        #subjectSelect:focus {
            outline: none;
            border-color: #1f4068;
            box-shadow: 0 0 0 4px rgba(31, 64, 104, 0.15);
        }

        .select-wrapper::after {
            content: '▼'; /* Flecha personalizada */
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            pointer-events: none;
        }

        /* Input para añadir nueva categoría */
        .new-subject-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 1rem;
        }

        /* Estilo para el input de tipo file oculto */
        #fileInput {
            display: none;
        }

        /* Media Queries para Responsividad */
        @media (max-width: 900px) {
            .header h1 {
                font-size: 2.2rem;
            }
            .header p {
                font-size: 1rem;
            }
            .nav-tab {
                font-size: 1rem;
                padding: 18px;
            }
            .tab-content {
                padding: 30px;
            }
            .upload-zone {
                padding: 40px;
            }
            .stat-number {
                font-size: 2.5rem;
            }
            .stat-label {
                font-size: 1rem;
            }
            .material-title {
                font-size: 1.3rem;
            }
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            .nav-tab {
                border-bottom: 1px solid #d0dbe9; /* Separador en vista móvil */
            }
            .nav-tab.active::after {
                width: 50%; /* Más pequeño en móvil */
            }
            .material-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .tab-content {
                padding: 20px;
            }
            .stats-grid {
                grid-template-columns: 1fr; /* Una columna en móvil */
            }
            .btn {
                width: 100%; /* Botones a ancho completo */
                margin: 8px 0;
            }
            .select-wrapper {
                margin-bottom: 15px; /* Espacio extra para el select */
            }
            #reportControls {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .container {
                border-radius: 10px;
            }
            .header {
                padding: 25px;
            }
            .header h1 {
                font-size: 1.8rem;
            }
            .header p {
                font-size: 0.9rem;
            }
            .upload-zone {
                padding: 30px;
            }
            .upload-icon {
                font-size: 2.5rem;
            }
            .upload-zone h3 {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎓 Academic Navigator AI</h1>
            <p>Tu asistente inteligente para gestionar y potenciar tu aprendizaje universitario. Sube, organiza y analiza tu material de estudio con IA.</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="materials">📚 Mis Materias</button>
            <button class="nav-tab" data-tab="reports">📝 Generar Informes</button>
            <button class="nav-tab" data-tab="analysis">🔍 Análisis Avanzado</button>
        </div>

        <div id="materials" class="tab-content active">
            <div class="upload-zone" id="materialUploadZone">
                <div class="upload-icon">📁</div>
                <h3>Arrastra tus archivos aquí o haz clic para subir</h3>
                <p>Formatos soportados: PDF, DOCX, TXT, MD, JPG, PNG (para imágenes)</p>
                <input type="file" id="fileInput" multiple accept=".pdf,.docx,.txt,.md,.jpg,.jpeg,.png">
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalMaterials">0</div>
                    <div class="stat-label">Documentos Subidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalWords">0</div>
                    <div class="stat-label">Palabras Analizadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalSubjects">0</div>
                    <div class="stat-label">Categorías Creadas</div>
                </div>
            </div>

            <div class="analysis-title">📂 Materiales Organizados por Categoría</div>
            <div id="materialsList">
                <div class="empty-state">
                    <div class="empty-icon">📚</div>
                    <h3>Aún no tienes materiales. ¡Comienza a subir!</h3>
                    <p>Sube tus primeros documentos de estudio para que Academic Navigator AI los organice por ti.</p>
                </div>
            </div>
        </div>

        <div id="reports" class="tab-content">
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 25px; flex-wrap: wrap;">
                <div class="select-wrapper">
                    <select id="subjectSelect">
                        <option value="">Selecciona una categoría de estudio</option>
                        <option value="new-subject">➕ Añadir nueva categoría...</option>
                    </select>
                </div>
                <button class="btn" onclick="generateReport()">🤖 Generar Informe IA</button>
            </div>
            
            <div id="newSubjectInputContainer" class="hidden" style="margin-bottom: 25px;">
                <input type="text" id="newSubjectName" class="new-subject-input" placeholder="Nombre de la nueva categoría (ej: 'Matemáticas Avanzadas')" onkeydown="if(event.key === 'Enter') addCustomSubject()">
                <button class="btn btn-secondary" style="margin-left: 10px; margin-top: 0;" onclick="addCustomSubject()">✅ Añadir</button>
            </div>

            <textarea id="reportText" class="textarea" placeholder="Tu informe se generará aquí. También puedes escribirlo o pegarlo para analizarlo..."></textarea>
            
            <div id="reportControls" style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                <button class="btn" onclick="analyzeReport()">🔍 Analizar Informe Completo</button>
                <button class="btn btn-secondary" onclick="checkGrammar()">✏️ Revisión Ortográfica y Gramatical</button>
                <button class="btn btn-secondary" onclick="improveReport()">⚡ Mejorar Estilo y Coherencia</button>
                <button class="btn btn-secondary" onclick="addImagesToReport()">🖼️ Insertar Imágenes</button>
                <button class="btn btn-secondary" onclick="exportReport()">💾 Exportar Informe</button>
            </div>
        </div>

        <div id="analysis" class="tab-content">
            <div id="analysisContent">
                <div class="empty-state">
                    <div class="empty-icon">📈</div>
                    <h3>No hay análisis para mostrar.</h3>
                    <p>Genera o pega un informe en la pestaña "Generar Informes" y haz clic en "Analizar Informe Completo" para ver los resultados.</p>
                </div>
            </div>
            <div id="loadingAnalysis" class="loading hidden">
                <div class="spinner"></div>
                <p>Analizando tu informe con IA... Esto puede tomar un momento.</p>
            </div>
        </div>
    </div>

    <script>
        // *** Estado Global de la Aplicación (Simulado para Frontend) ***
        let appState = {
            materials: [], // Almacenará metadatos de los materiales
            currentReport: '',
            lastAnalysis: null,
            subjects: new Set(), // Conjunto de categorías
            // URL base de tu futuro backend API
            backendUrl: 'http://127.0.0.1:5000' // ¡Importante! Cambia esto por la URL de tu servidor real
        };

        // *** Inicialización al Cargar el DOM ***
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            loadInitialData(); // Cargar datos si existen (simulado por ahora)
            updateStats();
            updateSubjectSelect();
            // Mostrar la primera pestaña por defecto
            showTab('materials'); 
        });

        // *** Gestión de Event Listeners ***
        function setupEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadZone = document.getElementById('materialUploadZone');
            const navTabs = document.querySelector('.nav-tabs');
            const subjectSelect = document.getElementById('subjectSelect');

            // Event listener para el input de archivo (oculto)
            fileInput.addEventListener('change', handleFileUpload);
            
            // Event listeners para Drag & Drop en la zona de carga
            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.classList.add('dragover');
            });
            uploadZone.addEventListener('dragleave', () => {
                uploadZone.classList.remove('dragover');
            });
            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.classList.remove('dragover');
                handleFileUpload({ target: { files: e.dataTransfer.files } });
            });
            // Click en la zona de carga para abrir el diálogo de archivos
            uploadZone.addEventListener('click', () => {
                fileInput.click();
            });

            // Event listener para los botones de navegación
            navTabs.addEventListener('click', (e) => {
                if (e.target.classList.contains('nav-tab')) {
                    showTab(e.target.dataset.tab);
                }
            });

            // Event listener para el cambio en el selector de materias
            subjectSelect.addEventListener('change', (e) => {
                if (e.target.value === 'new-subject') {
                    document.getElementById('newSubjectInputContainer').classList.remove('hidden');
                    document.getElementById('newSubjectName').focus();
                } else {
                    document.getElementById('newSubjectInputContainer').classList.add('hidden');
                }
            });
        }

        // *** Funciones de Navegación entre Pestañas ***
        function showTab(tabName) {
            // Ocultar todas las pestañas de contenido y desactivar botones
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar la pestaña seleccionada y activar su botón
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.nav-tab[data-tab="${tabName}"]`).classList.add('active');
        }

        // *** Carga y Gestión de Archivos (Simulación/Preparación para Backend) ***
        async function handleFileUpload(event) {
            const files = Array.from(event.target.files);
            if (files.length === 0) return;

            // Mostrar un estado de carga global o por archivo si es posible
            console.log(`Subiendo ${files.length} archivo(s)...`);
            // Aquí en una implementación real, mostrarías un spinner o una barra de progreso.
            // Por simplicidad, solo registro en consola y hago una simulación de carga.

            // Simulación de subida para el frontend (el backend lo manejará de verdad)
            for (const file of files) {
                // Validación básica de tamaño en frontend (puedes ajustar el límite)
                const MAX_FILE_SIZE_MB = 100; // Ejemplo: 100 MB por archivo en el frontend. El backend puede tener un límite mayor.
                if (file.size > MAX_FILE_SIZE_MB * 1024 * 1024) {
                    alert(`El archivo "${file.name}" excede el tamaño máximo permitido de ${MAX_FILE_SIZE_MB}MB. Por favor, sube archivos más pequeños.`);
                    continue; // Pasa al siguiente archivo
                }

                const reader = new FileReader();
                reader.onloadend = async function(e) {
                    const contentPreview = e.target.result.substring(0, 5000); // Solo una previsualización
                    const wordCount = contentPreview.split(/\s+/).filter(word => word.length > 0).length;

                    const material = {
                        id: Date.now() + Math.random(), // ID temporal
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        // En la implementación real, `content` no se almacenaría aquí, sino que se enviaría al backend
                        // y el backend guardaría el archivo o lo procesaría.
                        // Aquí solo para simular la vista previa.
                        contentPreview: contentPreview, 
                        wordCount: wordCount, // Esto será más preciso desde el backend
                        uploadDate: new Date().toLocaleString(),
                        subject: 'Pendiente de Asignar' // Se asignará o inferirá por el backend
                    };
                    
                    appState.materials.push(material);
                    // No añadir a appState.subjects aquí directamente. 
                    // El backend se encargará de clasificar y retornar las categorías.
                    updateMaterialsList();
                    updateStats();
                    updateSubjectSelect(); // Actualizar el selector por si acaso
                };
                // Leer como texto para previsualización, si es un tipo de texto
                if (file.type.startsWith('text/') || file.name.endsWith('.md') || file.name.endsWith('.docx') || file.name.endsWith('.pdf')) {
                    reader.readAsText(file);
                } else if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file); // Para imágenes, leer como URL de datos para previsualización
                } else {
                    // Para otros tipos, no leer el contenido directamente en el frontend
                    console.warn(`Tipo de archivo no compatible para previsualización en el frontend: ${file.type}`);
                    // Simular un material básico sin contenido preview
                    appState.materials.push({
                        id: Date.now() + Math.random(),
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        contentPreview: `Archivo binario o no textual: ${file.type}`,
                        wordCount: 0,
                        uploadDate: new Date().toLocaleString(),
                        subject: 'Pendiente de Asignar'
                    });
                    updateMaterialsList();
                    updateStats();
                    updateSubjectSelect();
                }

                // *** ESTO SERÍA EL PASO CLAVE PARA EL BACKEND REAL ***
                // Comentar o eliminar esta sección en el frontend si no tienes backend
                // const formData = new FormData();
                // formData.append('file', file);
                // formData.append('fileName', file.name);

                // try {
                //     // Aquí enviarías el archivo al backend
                //     const response = await fetch(`${appState.backendUrl}/upload-material`, {
                //         method: 'POST',
                //         body: formData
                //     });
                //     if (!response.ok) {
                //         throw new Error(`Error en la subida: ${response.statusText}`);
                //     }
                //     const result = await response.json();
                //     console.log('Archivo subido y procesado por el backend:', result);
                //     // Actualizar el estado del material con la info del backend (categoría, wordCount real, etc.)
                //     // result.materialData contendría id, name, type, size, contentPreview, wordCount, uploadDate, subject
                //     // appState.materials = appState.materials.filter(m => m.id !== material.id); // Eliminar la simulación
                //     // appState.materials.push(result.materialData);
                //     // appState.subjects.add(result.materialData.subject);
                //     // updateMaterialsList();
                //     // updateStats();
                //     // updateSubjectSelect();
                // } catch (error) {
                //     console.error('Fallo al subir el archivo:', error);
                //     alert(`No se pudo subir "${file.name}". Inténtalo de nuevo. Error: ${error.message}`);
                //     // Opcional: Eliminar material simulado si falló la subida real
                //     // appState.materials = appState.materials.filter(m => m.id !== material.id);
                //     // updateMaterialsList();
                //     // updateStats();
                // }
            }
        }

        function extractSubject(filename) {
            // Esta función se moverá en gran parte al backend para una clasificación más inteligente
            const name = filename.toLowerCase().replace(/\.[^/.]+$/, "");
            
            const commonKeywords = {
                'matematicas': 'Matemáticas', 'fisica': 'Física', 'quimica': 'Química', 
                'biologia': 'Biología', 'historia': 'Historia', 'literatura': 'Literatura', 
                'filosofia': 'Filosofía', 'economia': 'Economía', 'derecho': 'Derecho', 
                'psicologia': 'Psicología', 'ingles': 'Inglés', 'español': 'Español', 
                'programacion': 'Programación', 'informatica': 'Informática', 'estadistica': 'Estadística',
                'calculo': 'Matemáticas', 'algebra': 'Matemáticas', 'geometria': 'Matemáticas',
                'circuitos': 'Física', 'termondinamica': 'Física', 'optica': 'Física',
                'organica': 'Química', 'inorganica': 'Química', 'bioquimica': 'Biología',
                'sistemas': 'Informática', 'redes': 'Informática', 'bases de datos': 'Informática',
                'constitucion': 'Derecho', 'civil': 'Derecho', 'penal': 'Derecho',
                'psicoanalisis': 'Psicología', 'cognitiva': 'Psicología',
                'poesia': 'Literatura', 'novela': 'Literatura',
                'antigua': 'Historia', 'moderna': 'Historia',
                'microeconomia': 'Economía', 'macroeconomia': 'Economía'
            };
            
            for (let keyword in commonKeywords) {
                if (name.includes(keyword)) {
                    return commonKeywords[keyword];
                }
            }
            
            return 'General / No Clasificado';
        }

        // Función para cargar datos iniciales (simulados)
        function loadInitialData() {
            // Esto es solo para que veas algo al inicio. En la realidad, cargarías de la base de datos.
            appState.materials = [
                { id: 1, name: 'Introduccion a la Programacion.pdf', type: 'application/pdf', size: 1234567, contentPreview: 'Contenido de programación...', wordCount: 15000, uploadDate: '01/07/2025, 10:00:00', subject: 'Programación' },
                { id: 2, name: 'Fundamentos de Economia.docx', type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', size: 2345678, contentPreview: 'Principios económicos...', wordCount: 22000, uploadDate: '02/07/2025, 11:30:00', subject: 'Economía' },
                { id: 3, name: 'Historia Antigua - Roma.txt', type: 'text/plain', size: 345678, contentPreview: 'El Imperio Romano...', wordCount: 8000, uploadDate: '03/07/2025, 14:15:00', subject: 'Historia' }
            ];
            appState.materials.forEach(m => appState.subjects.add(m.subject));
            updateMaterialsList();
        }

        function updateMaterialsList() {
            const listContainer = document.getElementById('materialsList');
            
            if (appState.materials.length === 0) {
                listContainer.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📚</div>
                        <h3>Aún no tienes materiales. ¡Comienza a subir!</h3>
                        <p>Sube tus primeros documentos de estudio para que Academic Navigator AI los organice por ti.</p>
                    </div>
                `;
                return;
            }

            // Agrupar materiales por categoría
            const materialsByCategory = {};
            appState.materials.forEach(material => {
                const subject = material.subject || 'Sin Categoría';
                if (!materialsByCategory[subject]) {
                    materialsByCategory[subject] = [];
                }
                materialsByCategory[subject].push(material);
            });

            let htmlContent = '';
            for (const subject in materialsByCategory) {
                htmlContent += `
                    <div class="analysis-section">
                        <div class="analysis-title">✨ ${subject} (${materialsByCategory[subject].length} Documentos)</div>
                `;
                htmlContent += materialsByCategory[subject].map(material => {
                    let icon = '📄';
                    if (material.type.includes('pdf')) icon = ' পিডিএফ';
                    else if (material.type.includes('docx')) icon = ' 🖺';
                    else if (material.type.includes('txt') || material.type.includes('md')) icon = ' 📝';
                    else if (material.type.includes('image')) icon = ' 🖼️';

                    return `
                        <div class="material-item">
                            <div class="material-header">
                                <div class="material-title">${icon} ${material.name}</div>
                                <div class="material-type">${material.subject}</div>
                            </div>
                            <div class="material-content">
                                <p><strong>Palabras:</strong> ${material.wordCount.toLocaleString()}</p>
                                <p><strong>Tamaño:</strong> ${(material.size / (1024 * 1024)).toFixed(2)} MB</p>
                                <p><strong>Subido:</strong> ${material.uploadDate}</p>
                                <p><strong>Previsualización:</strong> ${material.contentPreview.substring(0, 200)}...</p>
                            </div>
                            <button class="btn btn-danger" onclick="removeMaterial(${material.id})">🗑️ Eliminar</button>
                        </div>
                    `;
                }).join('');
                htmlContent += `</div>`; // Cierra analysis-section
            }
            listContainer.innerHTML = htmlContent;
        }

        function updateStats() {
            document.getElementById('totalMaterials').textContent = appState.materials.length;
            document.getElementById('totalWords').textContent = appState.materials.reduce((sum, m) => sum + m.wordCount, 0).toLocaleString();
            document.getElementById('totalSubjects').textContent = appState.subjects.size;
        }

        function updateSubjectSelect() {
            const select = document.getElementById('subjectSelect');
            // Guardar la opción "Añadir nueva categoría"
            const newSubjectOption = select.querySelector('option[value="new-subject"]');
            select.innerHTML = '<option value="">Selecciona una categoría de estudio</option>';
            
            // Ordenar las categorías alfabéticamente
            const sortedSubjects = Array.from(appState.subjects).sort();

            sortedSubjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                select.appendChild(option);
            });
            // Reinsertar la opción "Añadir nueva categoría" al final
            if (newSubjectOption) {
                select.appendChild(newSubjectOption);
            } else {
                const option = document.createElement('option');
                option.value = 'new-subject';
                option.textContent = '➕ Añadir nueva categoría...';
                select.appendChild(option);
            }
        }

        function addCustomSubject() {
            const newSubjectNameInput = document.getElementById('newSubjectName');
            const newSubjectName = newSubjectNameInput.value.trim();

            if (newSubjectName && !appState.subjects.has(newSubjectName)) {
                appState.subjects.add(newSubjectName);
                updateSubjectSelect();
                document.getElementById('subjectSelect').value = newSubjectName; // Seleccionar la nueva categoría
                newSubjectNameInput.value = ''; // Limpiar el input
                document.getElementById('newSubjectInputContainer').classList.add('hidden');
            } else if (appState.subjects.has(newSubjectName)) {
                alert('Esa categoría ya existe.');
            } else {
                alert('Por favor, ingresa un nombre para la nueva categoría.');
            }
        }

        function removeMaterial(id) {
            appState.materials = appState.materials.filter(m => m.id !== id);
            // Reconstruir el set de subjects basado en los materiales restantes
            appState.subjects = new Set(appState.materials.map(m => m.subject).filter(s => s)); // Filtrar undefined/null
            updateMaterialsList();
            updateStats();
            updateSubjectSelect();
        }

        // *** Funciones de Informes y Análisis (Preparación para Backend) ***
        async function generateReport() {
            const selectedSubject = document.getElementById('subjectSelect').value;
            if (!selectedSubject || selectedSubject === 'new-subject') {
                alert('Por favor, selecciona una categoría válida para generar el informe.');
                return;
            }
            
            // Aquí, en una implementación real, enviarías la solicitud al backend
            // El backend buscaría los materiales de esa materia y generaría el informe.
            // Para la simulación, uso los materiales del frontend.
            const relevantMaterials = appState.materials.filter(m => m.subject === selectedSubject);
            
            if (relevantMaterials.length === 0) {
                alert('No hay materiales asociados a esta categoría para generar un informe.');
                return;
            }
            
            // Simular generación de informe con IA (esto sería un llamado al backend)
            document.getElementById('reportText').value = "Generando informe... por favor espera.";
            // Simular una pequeña demora de red
            await new Promise(resolve => setTimeout(resolve, 1500)); 
            
            const reportContent = generateReportContent(relevantMaterials);
            document.getElementById('reportText').value = reportContent;
            appState.currentReport = reportContent;

            alert('Informe generado con éxito. ¡Revísalo y mejora con el análisis IA!');

            // En un escenario real:
            // try {
            //     const response = await fetch(`${appState.backendUrl}/generate-report`, {
            //         method: 'POST',
            //         headers: { 'Content-Type': 'application/json' },
            //         body: JSON.stringify({ subject: selectedSubject })
            //     });
            //     if (!response.ok) throw new Error('No se pudo generar el informe.');
            //     const data = await response.json();
            //     document.getElementById('reportText').value = data.reportContent;
            //     appState.currentReport = data.reportContent;
            // } catch (error) {
            //     console.error('Error al generar informe:', error);
            //     alert('Hubo un error al generar el informe. Inténtalo de nuevo.');
            //     document.getElementById('reportText').value = "Error al generar el informe.";
            // }
        }

        // Función simulada para generar contenido de informe (sería manejada por el backend)
        function generateReportContent(materials) {
            const subject = materials[0].subject;
            const totalWords = materials.reduce((sum, m) => sum + m.wordCount, 0);
            
            return `# Informe Detallado de ${subject}

## Introducción y Alcance
Este informe ha sido compilado a partir de ${materials.length} documentos de estudio pertenecientes a la categoría de **${subject}**, sumando un total aproximado de **${totalWords.toLocaleString()} palabras**. El objetivo es consolidar y presentar de manera estructurada los conceptos fundamentales y los puntos clave abordados en el material proporcionado.

## Desarrollo Temático y Síntesis de Contenidos
${materials.map(m => `
### Título del Documento: ${m.name.replace(/\.[^/.]+$/, "")}
* **Origen:** Material subido el ${m.uploadDate}.
* **Extracto Clave:** > ${m.contentPreview.substring(0, 400).split('\n').map(line => line.trim()).filter(line => line.length > 0).join(' ')}...
    
    Este segmento introduce los aspectos principales de "${m.name.replace(/\.[^/.]+$/, "")}", sentando las bases para una comprensión más profunda. [Referencia: ${m.name}]
`).join('\n')}

## Análisis y Observaciones Clave
Basado en la integración de los documentos, se observa que los conceptos de [Concepto 1] y [Concepto 2] son recurrentes y fundamentales. La interconexión entre [Tema A] y [Tema B] es vital para el dominio completo de la materia. Se sugiere una revisión especial de los [Ejemplos/Casos de Estudio] mencionados, ya que ilustran la aplicación práctica de la teoría.

## Conclusiones y Recomendaciones
Los materiales analizados ofrecen una visión integral de **${subject}**. Para una comprensión exhaustiva, se recomienda:
1.  Profundizar en la conceptualización de [Concepto Sugerido para Profundizar].
2.  Realizar ejercicios prácticos que involucren [Habilidad Práctica Sugerida].
3.  Consultar fuentes adicionales sobre [Tema Específico] para una perspectiva ampliada.

## Referencias Bibliográficas Generadas (Formato APA 7ma Edición)
${materials.map(m => `- ${m.name.replace(/\.[^/.]+$/, "")}. (${new Date(m.uploadDate).getFullYear()}). *[Tipo de Material, ej: Guía de Estudio/Apuntes]*. Recuperado de tus archivos personales.`).join('\n')}

---
*Informe generado automáticamente por Academic Navigator AI el ${new Date().toLocaleString()}.*
*Este es un borrador inicial y requiere tu revisión y personalización para lograr la máxima calidad académica.*`;
        }

        async function analyzeReport() {
            const reportText = document.getElementById('reportText').value;
            if (!reportText.trim()) {
                alert('Por favor, escribe o genera un informe en la pestaña "Generar Informes" antes de analizarlo.');
                return;
            }
            
            // Mostrar estado de carga y cambiar a la pestaña de análisis
            showTab('analysis');
            document.getElementById('analysisContent').innerHTML = ''; // Limpiar contenido anterior
            document.getElementById('loadingAnalysis').classList.remove('hidden');

            // En un escenario real, esto sería una llamada al backend
            // try {
            //     const response = await fetch(`${appState.backendUrl}/analyze-report`, {
            //         method: 'POST',
            //         headers: { 'Content-Type': 'application/json' },
            //         body: JSON.stringify({ reportContent: reportText })
            //     });
            //     if (!response.ok) throw new Error('Error al analizar el informe.');
            //     const analysisResult = await response.json();
            //     appState.lastAnalysis = analysisResult;
            //     displayAnalysis(analysisResult);
            // } catch (error) {
            //     console.error('Fallo al analizar el informe:', error);
            //     document.getElementById('analysisContent').innerHTML = `<div class="error-item">Error al realizar el análisis: ${error.message}. Por favor, inténtalo de nuevo.</div>`;
            // } finally {
            //     document.getElementById('loadingAnalysis').classList.add('hidden');
            // }

            // Simulación de análisis para el frontend (reemplazar con llamada a backend)
            await new Promise(resolve => setTimeout(resolve, 3000)); // Simula tiempo de procesamiento
            const analysisResult = performSimulatedAnalysis(reportText); // Usar función simulada
            appState.lastAnalysis = analysisResult;
            displayAnalysis(analysisResult);
            document.getElementById('loadingAnalysis').classList.add('hidden');
        }

        // Función simulada de análisis (¡ESTO DEBE SER IMPLEMENTADO EN EL BACKEND CON IA REAL!)
        function performSimulatedAnalysis(text) {
            const words = text.split(/\s+/).filter(w => w.length > 0);
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const paragraphs = text.split(/\n\s*\n/).filter(p => p.trim().length > 0);
            
            // Simulación de detección de IA (muy básica, el backend usaría modelos ML)
            let aiScore = Math.floor(Math.random() * 100); // Aleatorio para simular
            let aiSuggestion = '';
            if (aiScore > 70) {
                aiSuggestion = 'Tu informe parece tener un alto nivel de contenido generado por IA. Para reducir esto, intenta reescribir secciones con tus propias palabras, añade ejemplos personales o detalles específicos que no se encuentren fácilmente online, y utiliza tu estilo de escritura único. Evita copiar y pegar directamente.';
            } else if (aiScore > 40) {
                aiSuggestion = 'El informe tiene algunas características de contenido generado por IA. Revisa las frases genéricas o repetitivas, y busca oportunidades para inyectar más originalidad y profundidad en tus argumentos. Incorpora más tu voz personal.';
            } else {
                aiSuggestion = 'El contenido de tu informe muestra originalidad. ¡Excelente trabajo! Continúa desarrollando tu estilo único.';
            }

            // Simulación de detección de "planicie" (falta de profundidad/ejemplos)
            let flatnessSuggestion = '';
            if (words.length < 500 && paragraphs.length < 5) {
                flatnessSuggestion = 'Tu informe se siente un poco plano. Considera expandir tus ideas, añadir más detalles, ejemplos concretos, estudios de caso o argumentos de soporte. Profundiza en los conceptos clave y ofrece tu propia perspectiva.';
            } else if (text.split('por ejemplo').length < 2 && text.split('en contraste').length < 2) {
                flatnessSuggestion = 'Para enriquecer tu informe, podrías incluir más ejemplos, analogías o comparaciones para ilustrar tus puntos. La diversificación de las fuentes y perspectivas también ayuda a dar mayor profundidad.';
            } else {
                flatnessSuggestion = 'Tu informe presenta una buena profundidad. ¡Sigue así!';
            }

            // Análisis de legibilidad simulado (Flesch-Kincaid simplificado)
            const avgWordsPerSentence = words.length / (sentences.length || 1);
            const avgSentencesPerParagraph = sentences.length / (paragraphs.length || 1);
            
            let readabilityScore = 100 - (avgWordsPerSentence * 2) - (avgSentencesPerParagraph * 3);
            readabilityScore = Math.max(0, Math.min(100, Math.floor(readabilityScore)));
            
            // Errores y sugerencias básicas (el backend haría esto con NLP avanzado)
            const commonErrors = [
                { word: 'hice', correct: 'hice (ej. "Yo hice") o hice (ej. "Ella hizo")', type: 'Gramática' },
                { word: 'valla', correct: 'valla (cerca), vaya (ir), baya (fruto)', type: 'Ortografía/Uso' },
                { word: 'más o menos', correct: 'más o menos (siempre separado)', type: 'Estilo' },
                { word: 'etc...', correct: 'etc. (sin puntos suspensivos)', type: 'Estilo' }
            ];
            
            const errors = [];
            commonErrors.forEach(error => {
                if (text.toLowerCase().includes(error.word)) {
                    errors.push(error);
                }
            });

            const suggestions = [];
            if (readabilityScore < 60) {
                suggestions.push({
                    type: 'Claridad',
                    suggestion: 'Tu texto podría ser más fácil de leer. Intenta usar oraciones más cortas y directas, y vocabulario más accesible.'
                });
            }
            if (paragraphs.length < 5 && words.length > 300) {
                suggestions.push({
                    type: 'Estructura',
                    suggestion: 'Considera dividir párrafos muy largos para mejorar el flujo de lectura y la organización.'
                });
            }
            if (!text.toLowerCase().includes('bibliografía') && !text.toLowerCase().includes('referencias')) {
                suggestions.push({
                    type: 'Académico',
                    suggestion: 'Es crucial incluir una sección de referencias o bibliografía al final de tu informe para dar crédito a las fuentes y apoyar tus argumentos.'
                });
            }
            if (!text.toLowerCase().includes('introducción') && words.length > 500) {
                suggestions.push({
                    type: 'Estructura',
                    suggestion: 'Asegúrate de tener una introducción clara que presente el tema y el propósito del informe.'
                });
            }
            if (!text.toLowerCase().includes('conclusión') && words.length > 500) {
                suggestions.push({
                    type: 'Estructura',
                    suggestion: 'Una conclusión efectiva resume los puntos clave y ofrece una perspectiva final o implicaciones.'
                });
            }
            
            return {
                wordCount: words.length,
                sentenceCount: sentences.length,
                paragraphCount: paragraphs.length,
                readabilityScore: readabilityScore,
                avgWordsPerSentence: Math.round(avgWordsPerSentence),
                avgSentencesPerParagraph: Math.round(avgSentencesPerParagraph * 10) / 10,
                aiDetection: { score: aiScore, suggestion: aiSuggestion },
                flatnessDetection: { suggestion: flatnessSuggestion },
                errors: errors,
                suggestions: suggestions
            };
        }

        function displayAnalysis(analysis) {
            let scoreClass = 'low';
            if (analysis.readabilityScore >= 70) scoreClass = 'high';
            else if (analysis.readabilityScore >= 50) scoreClass = 'medium';

            let aiScoreClass = 'high'; // Por defecto si no hay análisis o es bajo
            if (analysis.aiDetection.score <= 30) aiScoreClass = 'high';
            else if (analysis.aiDetection.score <= 70) aiScoreClass = 'medium';
            else aiScoreClass = 'low'; // Alto nivel de IA -> Bajo en originalidad

            document.getElementById('analysisContent').innerHTML = `
                <div class="analysis-section">
                    <div class="analysis-title">📊 Visión General del Informe</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${analysis.wordCount.toLocaleString()}</div>
                            <div class="stat-label">Palabras Totales</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${analysis.sentenceCount}</div>
                            <div class="stat-label">Oraciones</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${analysis.paragraphCount}</div>
                            <div class="stat-label">Párrafos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${analysis.avgWordsPerSentence}</div>
                            <div class="stat-label">Palabras/Oración</div>
                        </div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="analysis-title">🎯 Puntuación de Legibilidad</div>
                    <div class="ai-score ${scoreClass}">${analysis.readabilityScore}/100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${analysis.readabilityScore}%"></div>
                    </div>
                    <p style="color: #555;">Una puntuación alta indica que tu texto es fácil de comprender. Si es baja, considera simplificar oraciones y vocabulario.</p>
                </div>

                <div class="analysis-section">
                    <div class="analysis-title">🤖 Detección de Contenido IA</div>
                    <div class="ai-score ${aiScoreClass}">Nivel IA: ${analysis.aiDetection.score}%</div>
                    <p style="color: #555;">${analysis.aiDetection.suggestion}</p>
                </div>

                <div class="analysis-section">
                    <div class="analysis-title">✨ Sugerencias de Profundidad</div>
                    <p style="color: #555;">${analysis.flatnessDetection.suggestion}</p>
                </div>
                
                ${analysis.errors.length > 0 ? `
                <div class="analysis-section">
                    <div class="analysis-title">❌ Errores y Puntos a Corregir</div>
                    ${analysis.errors.map(error => `
                        <div class="error-item">
                            <div class="error-type">${error.type}</div>
                            <div>Se encontró: "${error.word}" → Sugerencia: "${error.correct}"</div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${analysis.suggestions.length > 0 ? `
                <div class="analysis-section">
                    <div class="analysis-title">💡 Sugerencias de Mejora Adicional</div>
                    ${analysis.suggestions.map(suggestion => `
                        <div class="suggestion-item">
                            <div class="suggestion-type">${suggestion.type}</div>
                            <div>${suggestion.suggestion}</div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;
        }

        async function checkGrammar() {
            const text = document.getElementById('reportText').value;
            if (!text.trim()) {
                alert('Por favor, escribe algo para revisar la ortografía y gramática.');
                return;
            }
            
            alert('Activando revisión. En un sistema real, esto enviaría el texto a un servicio de corrección avanzado (ej. LanguageTool API, o un modelo NLP propio en el backend) y mostraría las correcciones directamente en el texto o como sugerencias.');
            // Ejemplo para backend:
            // try {
            //     const response = await fetch(`${appState.backendUrl}/check-grammar`, {
            //         method: 'POST',
            //         headers: { 'Content-Type': 'application/json' },
            //         body: JSON.stringify({ text: text })
            //     });
            //     const result = await response.json();
            //     // Aquí actualizarías el textarea con el texto corregido o mostrarías las sugerencias
            //     console.log('Correcciones:', result.corrections);
            //     alert('Revisión completada. Consulta la consola para ver las correcciones (o implementa una UI más visual).');
            // } catch (error) {
            //     console.error('Error al revisar gramática:', error);
            //     alert('Hubo un error al revisar la gramática. Inténtalo de nuevo.');
            // }
        }

        async function improveReport() {
            const text = document.getElementById('reportText').value;
            if (!text.trim()) {
                alert('Por favor, escribe algo para mejorar el contenido.');
                return;
            }
            
            alert('Mejorando el informe con IA... Esto tomará un momento. En un sistema real, el backend reescribiría y expandiría el texto.');
            document.getElementById('reportText').value = "Mejorando el contenido, por favor espera...";

            // Simulación de mejora (¡Esto debe ser un modelo de lenguaje grande en el backend!)
            await new Promise(resolve => setTimeout(resolve, 3000));
            const improvedText = text + '\n\n### Sección Expandida y Mejorada por Academic Navigator AI\n\nEsta parte del informe ha sido enriquecida para aumentar la profundidad, la coherencia y la claridad. Se han añadido detalles, ejemplos hipotéticos y se ha refinado la estructura para una lectura más fluida. Recuerda personalizar y validar esta mejora con tu propio conocimiento.\n\n* **Clarificación de Conceptos:** Se han desglosado términos complejos para facilitar la comprensión.\n* **Ampliación de Argumentos:** Se han desarrollado ideas principales con mayor detalle y soporte.\n* **Mejora de Transiciones:** Las conexiones entre párrafos y secciones son ahora más fluidas.\n\n*Recuerda que este es un punto de partida avanzado, pero tu toque personal es indispensable.*';
            
            document.getElementById('reportText').value = improvedText;
            alert('¡Informe mejorado significativamente! Revisa las adiciones y ajusta a tus necesidades.');

            // En un escenario real:
            // try {
            //     const response = await fetch(`${appState.backendUrl}/improve-report`, {
            //         method: 'POST',
            //         headers: { 'Content-Type': 'application/json' },
            //         body: JSON.stringify({ reportContent: text })
            //     });
            //     if (!response.ok) throw new Error('No se pudo mejorar el informe.');
            //     const data = await response.json();
            //     document.getElementById('reportText').value = data.improvedContent;
            //     alert('Informe mejorado con éxito. Revisa el nuevo contenido.');
            // } catch (error) {
            //     console.error('Error al mejorar informe:', error);
            //     alert('Hubo un error al mejorar el informe. Inténtalo de nuevo.');
            //     document.getElementById('reportText').value = "Error al mejorar el informe.";
            // }
        }

        async function addImagesToReport() {
            alert('Esta función es para el backend. En una implementación real, aquí se abriría un diálogo para seleccionar imágenes ya subidas o para subir nuevas, y el bot las insertaría en el informe con formato adecuado.');
            // Para un backend:
            // 1. Mostraría una interfaz para seleccionar imágenes ya subidas o para subir nuevas.
            // 2. El usuario selecciona la imagen y posiblemente la posición.
            // 3. El backend procesa la imagen (redimensiona, optimiza, sube a un CDN/almacén).
            // 4. El backend o el frontend inserta una etiqueta <img> o un marcador de posición Markdown en el textarea.
            // Ejemplo: `![Descripción de la imagen](URL_de_la_imagen)`
            // alert('Funcionalidad de insertar imágenes activada. En una implementación real, aquí se gestionaría la inserción de imágenes desde tus materiales o nuevas subidas.');
        }


        function exportReport() {
            const text = document.getElementById('reportText').value;
            if (!text.trim()) {
                alert('No hay contenido en el informe para exportar.');
                return;
            }
            
            const filename = `Informe_AcademicNavigatorAI_${new Date().toISOString().slice(0,10)}.md`; // Formato Markdown sugerido
            const blob = new Blob([text], { type: 'text/markdown;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            alert('Informe exportado como archivo Markdown (.md).');
        }

        // *** Otras Utilidades (Bibliografía APA 7ma Edición) ***
        // Esta función sería parte del backend, que generaría referencias APA de forma inteligente
        // a partir de los metadatos de los documentos.
        function generateAPA7Reference(material) {
            const year = new Date(material.uploadDate).getFullYear();
            const author = "Autor Desconocido"; // Necesitarías extraer esto del contenido o metadatos
            const title = material.name.replace(/\.[^/.]+$/, "");
            const type = "Documento de estudio"; // Podría ser más específico (Libro, Artículo, etc.)

            return `${author}. (${year}). *${title}*. [${type}]. Recuperado de tus archivos personales.`;
        }

    </script>
</body>
</html>
